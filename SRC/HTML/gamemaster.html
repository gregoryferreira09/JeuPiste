<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Gamemaster - Jeu de Piste</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
  <style>
    #auth-section { margin: 2em 0; }
    #gm-content { display: none; }
  </style>
</head>
<body>
  <h1>Gamemaster : Interface de suivi</h1>

  <!-- Auth section -->
  <div id="auth-section">
    <input type="email" id="gm-email" placeholder="Email du gamemaster" required>
    <input type="password" id="gm-password" placeholder="Mot de passe" required>
    <button id="gm-login">Connexion Gamemaster</button>
    <div id="gm-auth-error" style="color:red;"></div>
  </div>

  <!-- Contenu réservé au gamemaster -->
  <div id="gm-content">
    <h2>Bienvenue, Gamemaster !</h2>
    <!-- Ici mets toutes tes fonctions et tables de suivi -->
    <div id="suivi"></div>
    <!-- ... -->
  </div>

  <script>
    // --- CONFIGURATION FIREBASE ---
    var firebaseConfig = {
      apiKey: "TA_CLE_API",
      authDomain: "TON_PROJET.firebaseapp.com",
      databaseURL: "https://TON_PROJET.firebaseio.com",
      projectId: "TON_PROJET",
      storageBucket: "TON_PROJET.appspot.com",
      messagingSenderId: "XXX",
      appId: "XXX"
    };
    firebase.initializeApp(firebaseConfig);

    // --- AUTHENTIFICATION GAMEMASTER ---
    document.getElementById('gm-login').onclick = function() {
      const email = document.getElementById('gm-email').value;
      const pass = document.getElementById('gm-password').value;
      firebase.auth().signInWithEmailAndPassword(email, pass)
        .then(() => {
          document.getElementById('gm-auth-error').textContent = "";
        })
        .catch(e => {
          document.getElementById('gm-auth-error').textContent = "Connexion échouée : " + e.message;
        });
    };

    // Bloque/débloque l'accès selon l'état d'authentification
    firebase.auth().onAuthStateChanged(user => {
      if (user) {
        document.getElementById('auth-section').style.display = "none";
        document.getElementById('gm-content').style.display = "block";
        // Lance ici le chargement du suivi, équipes, etc.
        chargerSuivi();
      } else {
        document.getElementById('auth-section').style.display = "block";
        document.getElementById('gm-content').style.display = "none";
      }
    });

    // --- EXEMPLE : AFFICHER LES ÉQUIPES ET LEUR AVANCEMENT ---
    function chargerSuivi() {
      const suiviDiv = document.getElementById('suivi');
      suiviDiv.innerHTML = "<em>Chargement en cours...</em>";
      // Exemple : lecture des équipes dans la Realtime Database
      firebase.database().ref("parties").once("value").then(snap => {
        let contenu = "<h3>Liste des parties</h3>";
        snap.forEach(partieSnap => {
          let partieId = partieSnap.key;
          contenu += `<div><strong>Partie : ${partieId}</strong><ul>`;
          let equipes = partieSnap.child("equipes");
          equipes.forEach(eqSnap => {
            let eqId = eqSnap.key;
            let eqData = eqSnap.val();
            contenu += `<li>Équipe ${eqId} - Avancement : ${eqData.etapeActuelle || 0}</li>`;
          });
          contenu += "</ul></div>";
        });
        suiviDiv.innerHTML = contenu;
      }).catch(e => {
        suiviDiv.innerHTML = "<span style='color:red'>Erreur lors du chargement : " + e.message + "</span>";
      });
    }
    // --- AJOUTE ICI TES AUTRES FONCTIONS (affichage fichiers, validations, etc.) ---
  </script>
</body>
</html>
