<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Lancement de la Partie - Jeu de piste</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Polices -->
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Cormorant+Garamond:wght@400;600&display=swap" rel="stylesheet">
  <!-- CSS global harmonisé -->
  <link rel="stylesheet" href="styles/style.css">
  <style>
    .lancement-jeu, .regle-jeu {
      margin: 16px 0 12px 0;
      padding: 12px;
      background: #f5f0e3;
      border: 1px solid #cba55a;
      border-radius: 7px;
      font-size: 1.09em;
      font-family: 'Cormorant Garamond', serif;
    }
    .lancement-jeu { font-weight: 600; color: #2e2510; }
    .regle-jeu    { color: #49413e; font-style: italic; }
  </style>
</head>
<body>
  <header>
    <h1 class="site-title">Lancement de la partie</h1>
  </header>
  <div class="center-wrapper">
    <main>
      <section class="main-accueil fadeIn" role="main" aria-live="polite">
        <div class="presentation-jeu" id="presentationJeu">
          <div class="lancement-jeu" id="lancement-jeu"></div>
          <div class="regle-jeu" id="regle-jeu"></div>
        </div>
        <div class="boutons-actions actions-bandeau">
          <a class="main-btn" id="demarrerBtn" href="personnages.html" style="pointer-events:none; opacity:0.6;">Disponible dans 30s</a>
          <button class="main-btn" id="btnRetourAccueil">Retour accueil</button>
        </div>
        <div class="info message" id="messageInfo"></div>
      </section>
    </main>
  </div>
  <footer class="footer">
    <p>© 2025 Jeu de piste. Tous droits réservés.</p>
    <a href="mentions-legales.html">Mentions légales</a>
  </footer>

  <!-- Fenêtre flottante confirmation retour accueil -->
  <div id="confirmationRetourAccueil" role="dialog" aria-modal="true" aria-labelledby="confirmationTitle" style="display:none;">
    <div class="main-accueil">
      <div class="modal-question" id="confirmationTitle">
        Voulez-vous vraiment quitter la partie et revenir à l’accueil ?
      </div>
      <div class="boutons-actions">
        <button id="confirmerRetourAccueilBtn" class="main-btn">Oui</button>
        <button id="annulerRetourAccueilBtn" class="main-btn">Non</button>
      </div>
    </div>
  </div>
  <div id="loader" aria-live="polite" style="display:none;">
    <div class="spinner"></div>
  </div>
  <div class="modal-toast" id="toast-message" role="alert" aria-live="assertive"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <!-- Initialisation Firebase AVANT toute utilisation -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD-BxBu-4ElCqbHrZPM-4-6yf1-yWnL1bI",
      authDomain: "murder-party-ba8d1.firebaseapp.com",
      databaseURL: "https://murder-party-ba8d1-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "murder-party-ba8d1",
      storageBucket: "murder-party-ba8d1.firebasestorage.app",
      messagingSenderId: "20295055805",
      appId: "1:20295055805:web:0963719c3f23ab7752fad4",
      measurementId: "G-KSBMBB7KMJ"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
  </script>

  <!-- Catalogue de lancements dynamiques -->
  <script src="JS/catalogue-lancements.js"></script>

  <!-- Script dynamique d'injection de l'ambiance et règle -->
  <script>
    // Récupération du scénario (adapte selon ton système, ici via localStorage)
    let scenario = JSON.parse(localStorage.getItem('scenarioTest'));
    let mode = scenario.mode;
    let nbEtapes = scenario.scenario.length;

    // Texte d'ambiance (tiré au hasard selon le mode)
    let lancementArray = LANCEMENT_TEXTE[mode] || [];
    let lancement = lancementArray.length ? lancementArray[Math.floor(Math.random() * lancementArray.length)] : "";

    // Règle dynamique adaptée au nombre d'étapes
    function regleAccordee(brut, N) {
      let phrase = brut.replace("{N}", N);
      if (N === 1) {
        phrase = phrase
          .replace(/étapes/gi, "étape")
          .replace(/\bsont\b/gi, "est")
          .replace(/\bindispensables\b/gi, "indispensable")
          .replace(/\bdéfis\b/gi, "défi")
          .replace(/\bmissions\b/gi, "mission")
          .replace(/\baventures\b/gi, "aventure");
      }
      return phrase;
    }
    let regles = REGLES_TEXTE[mode] || [];
    let regleBrute = regles.length ? regles[Math.floor(Math.random() * regles.length)] : "";
    let regle = regleAccordee(regleBrute, nbEtapes);

    document.getElementById('lancement-jeu').textContent = lancement;
    document.getElementById('regle-jeu').textContent = regle;
  </script>
  <!-- Si tu as un JS spécifique pour les boutons/actions, tu peux le remettre ici -->
</body>
</html>
